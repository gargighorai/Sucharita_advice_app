{% extends "base.html" %}
{% block title %}Give Advice{% endblock %}

{% block content %}
<div class="container mt-4">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="mb-0">Give Medical Advice</h3>
    <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left-circle me-1"></i> Back to Dashboard
    </a>
  </div>
<style>

</style>
  <form method="POST" action="{{ url_for('give_advice') }}">
    <div class="mb-3">
      <label for="patient_name" class="form-label">Patient Name</label>
      <input type="text" class="form-control" name="patient_name" id="patient_name" required>
    </div>

    <div class="mb-3">
      <label for="drugs" class="form-label">Select Drug/s</label>
      <select id="drugs" name="drugs" multiple class="form-control" size="6" required>
         {% for drug in drugs %}
         <option value="{{ drug.name }}">{{ drug.name }}</option>
        {% endfor %}
       </select>
      <small class="text-muted">You can select more than one drug.</small>
    </div>

    <div class="mb-3">
      <label for="advice" class="form-label mt-3">Prescribed Drugs</label>
<textarea id="advice" name="advice" class="form-control"  style="overflow: show; resize: none;"></textarea>  </div>

    <div class="d-flex justify-content-end gap-2">
      <button type="button" class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#cancelModal">
        Cancel
      </button>
      <button type="submit" class="btn btn-success">Submit Advice</button>
    </div>
  </form>
</div>

<!-- Cancel Confirmation Modal -->
<div class="modal fade" id="cancelModal" tabindex="-1" aria-labelledby="cancelModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-warning">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title" id="cancelModalLabel">Cancel Confirmation</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to cancel? All entered data will be lost.
      </div>
      <div class="modal-footer">
        <a href="{{ url_for('dashboard') }}" class="btn btn-danger">Yes, Cancel</a>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No, Go Back</button>
      </div>
    </div>
  </div>
</div>

<!-- JS for Select2 -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
const drugSelect = document.getElementById("drugs");
const adviceBox = document.getElementById("advice");

function updateAdviceList() {
  const selected = Array.from(drugSelect.selectedOptions).map(opt => opt.value);
  const formatted = selected.map((drug, i) => `${i + 1}. ${drug}`).join('\n');

  adviceBox.value = formatted;

  // Auto-resize the textarea to fit content
  adviceBox.style.height = 'auto'; // reset
  adviceBox.style.height = (adviceBox.scrollHeight + 4) + 'px'; // add padding if needed
}

// Attach event
drugSelect.addEventListener("change", updateAdviceList);
</script>

{% endblock %}


